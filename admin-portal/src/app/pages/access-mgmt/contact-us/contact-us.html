<div class="contact-us-page" [class.edit-scrollable]="editing">
    <div *ngIf="loading" class="contact-us-loading">Loading...</div>
    <div *ngIf="error" class="contact-us-error">{{ error }}</div>
    <div *ngIf="headOffice">
        <div class="contact-us-title">
            <ion-icon name="business-outline" class="contact-us-icon"></ion-icon>
            {{ headOffice.branchName || 'Head Office' }}
            <span class="contact-us-title-actions">
                <ng-container *ngIf="!editing">
                    <button class="contact-us-edit-btn" (click)="startEdit()">Edit</button>
                </ng-container>
                <ng-container *ngIf="editing">
                    <button type="button" class="contact-us-save-btn" (click)="saveEdit()">Save</button>
                    <button type="button" class="contact-us-cancel-btn" (click)="cancelEdit()">Cancel</button>
                </ng-container>
            </span>
        </div>
        <form class="contact-us-form" (ngSubmit)="saveEdit()" autocomplete="off">
            <div class="contact-us-row">
                <label class="contact-us-label" for="address">Address:</label>
                <div class="contact-us-input-wrapper">
                    <ion-icon name="location-sharp" class="contact-us-input-icon" (click)="openMapModal()"
                        style="cursor:pointer;"></ion-icon>
                    <input id="address" class="contact-us-input" type="text"
                        [value]="editing ? editModel.address : headOffice.address" [readonly]="!editing" name="address"
                        [(ngModel)]="editModel.address" *ngIf="editing" />
                    <input id="address" class="contact-us-input" type="text" [value]="headOffice.address" readonly
                        name="address" *ngIf="!editing" />
                </div>
            </div>
            <div class="contact-us-row">
                <label class="contact-us-label" for="contact">Contact Number:</label>
                <input id="contact" class="contact-us-input" type="text"
                    [value]="editing ? editModel.contact : headOffice.contact" [readonly]="!editing" name="contact"
                    [(ngModel)]="editModel.contact" *ngIf="editing" />
                <input id="contact" class="contact-us-input" type="text" [value]="headOffice.contact" readonly
                    name="contact" *ngIf="!editing" />
            </div>
            <div class="contact-us-row">
                <label class="contact-us-label" for="email">Email:</label>
                <input id="email" class="contact-us-input" type="email"
                    [value]="editing ? editModel.email : headOffice.email" [readonly]="!editing" name="email"
                    [(ngModel)]="editModel.email" *ngIf="editing" />
                <input id="email" class="contact-us-input" type="email" [value]="headOffice.email" readonly name="email"
                    *ngIf="!editing" />
            </div>
            <div class="contact-us-row">
                <label class="contact-us-label" for="hours">Operating Hours:</label>
                <input id="hours" class="contact-us-input" type="text"
                    [value]="editing
                        ? editModel.openTime + ' - ' + editModel.closeTime + ' (' + editModel.startDay + ' to ' + editModel.endDay + ')'
                        : headOffice.openTime + ' - ' + headOffice.closeTime + ' (' + headOffice.startDay + ' to ' + headOffice.endDay + ')'" readonly />
            </div>
            <ng-container *ngIf="editing">
                <div class="contact-us-row">
                    <label class="contact-us-label" for="openTime">Open Time:</label>
                    <input id="openTime" class="contact-us-input" type="time" [(ngModel)]="editModel.openTime"
                        name="openTime" />
                </div>
                <div class="contact-us-row">
                    <label class="contact-us-label" for="closeTime">Close Time:</label>
                    <input id="closeTime" class="contact-us-input" type="time" [(ngModel)]="editModel.closeTime"
                        name="closeTime" />
                </div>
                <div class="contact-us-row">
                    <label class="contact-us-label" for="startDay">Start Day:</label>
                    <input id="startDay" class="contact-us-input" type="text" [(ngModel)]="editModel.startDay"
                        name="startDay" />
                </div>
                <div class="contact-us-row">
                    <label class="contact-us-label" for="endDay">End Day:</label>
                    <input id="endDay" class="contact-us-input" type="text" [(ngModel)]="editModel.endDay"
                        name="endDay" />
                </div>
                <!--Hidden Fields
                <div class="contact-us-row">
                    <label class="contact-us-label" for="latitude">Latitude:</label>
                    <input id="latitude" class="contact-us-input" type="number" [(ngModel)]="editModel.latitude"
                        name="latitude" step="any" />
                </div>
                <div class="contact-us-row">
                    <label class="contact-us-label" for="longitude">Longitude:</label>
                    <input id="longitude" class="contact-us-input" type="number" [(ngModel)]="editModel.longitude"
                        name="longitude" step="any" />
                </div>
                -->
            </ng-container>
        </form>
    </div>
</div>

<!-- View-only modal -->
<div class="map-modal-backdrop" *ngIf="showMapModal && !editing" (click)="closeMapModal()"></div>
<div class="map-modal" *ngIf="showMapModal && !editing">
    <div class="map-modal-header">
        <span>Head Office Location</span>
        <button class="map-modal-close" (click)="closeMapModal()">&times;</button>
    </div>
    <div class="map-modal-body">
        <div id="googleMap" class="google-map"></div>
    </div>
</div>

<!-- Edit modal -->
<div class="map-modal-backdrop" *ngIf="showMapModal && editing" (click)="closeMapModal()"></div>
<div class="map-modal" *ngIf="showMapModal && editing">
    <div class="map-modal-header">
        <span>Set Head Office Location</span>
        <button class="map-modal-close" (click)="closeMapModal()">&times;</button>
    </div>
    <div class="map-modal-body">
        <input type="text" class="map-search-input" placeholder="Search location in Philippines..."
            (input)="onMapSearch($event.target.value)" />
        <div id="googleMapEdit" class="google-map" style="margin-top:1rem;"></div>
        <button class="map-modal-save-btn" (click)="saveMapLocation()">Save Location</button>
    </div>
</div>