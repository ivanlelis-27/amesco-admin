<div class="notif">
    <div class="notif-main">
        <div class="notif-row">
            <div class="notif-create">
                <input type="text" class="notif-title" placeholder="Title*" [(ngModel)]="title" />
                <input type="text" class="notif-desc" placeholder="Description" [(ngModel)]="description" />
                <textarea class="notif-body" placeholder="Message Body" [(ngModel)]="messageBody"></textarea>
                <div class="notif-when-row">
                    <label>When:</label>
                    <input matInput [matDatepicker]="picker" class="notif-when" [(ngModel)]="scheduledAt"
                        placeholder="Select Date" readonly (click)="picker.open()" />
                    <mat-datepicker #picker></mat-datepicker>
                </div>
                <div class="notif-image-row">
                    <label>
                        <input type="checkbox" [(ngModel)]="includeImage" />
                        Tick below to include image
                    </label>
                    <div class="notif-image-upload" (click)="imageInput.click()">
                        <ng-container *ngIf="!imagePreviewUrl; else previewImage">
                            <div class="image-icon">
                                <fa-icon [icon]="faImage"></fa-icon>
                            </div>
                        </ng-container>
                        <ng-template #previewImage>
                            <img [src]="imagePreviewUrl" alt="Preview"
                                style="width:100%;height:100%;object-fit:cover;border-radius:8px;" />
                        </ng-template>
                        <input #imageInput type="file" accept="image/*" style="display:none"
                            (change)="onImageSelected($event)" />
                    </div>
                </div>
                <button class="notif-create-btn" (click)="createNotification()">CREATE NOTIFICATION</button>
            </div>
            <div class="notif-history">
                <div class="notif-history-header">HISTORY</div>
                <div class="past-notif-list">
                    <div class="scheduled-notif-card" *ngFor="let notif of pagedPastNotifications">
                        <div class="scheduled-notif-card-row">
                            <div class="scheduled-notif-img">
                                <ng-container *ngIf="notif.includeImage && notif.imageBase64; else noImage">
                                    <img [src]="'data:image/png;base64,' + notif.imageBase64" alt="Notification Image"
                                        style="width:100%;height:100%;object-fit:cover;border-radius:8px;" />
                                </ng-container>
                                <ng-template #noImage>
                                    <div class="scheduled-notif-noimg">No Image</div>
                                </ng-template>
                            </div>
                            <div class="scheduled-notif-info">
                                <div class="scheduled-notif-title">{{ notif.title }}</div>
                                <div class="scheduled-notif-desc">{{ notif.description }}</div>
                                <div class="scheduled-notif-body">{{ notif.messageBody }}</div>
                                <div class="scheduled-notif-date">
                                    {{ notif.scheduledAt | date:'medium' }}
                                </div>
                            </div>
                            <button class="notif-trash-btn" (click)="confirmDeleteNotification(notif.notificationId)">
                                <ion-icon name="trash-outline" class="trash-icon"></ion-icon>
                            </button>
                        </div>
                    </div>
                    <div *ngIf="pagedPastNotifications.length === 0" class="scheduled-notif-empty">
                        No past scheduled notifications.
                    </div>
                    <div class="notif-history-pagination" *ngIf="historyTotalPages > 1">
                        <button (click)="goToHistoryPage(historyPage - 1)" [disabled]="historyPage === 1">&lt;</button>
                        <span>Page {{ historyPage }} of {{ historyTotalPages }}</span>
                        <button (click)="goToHistoryPage(historyPage + 1)"
                            [disabled]="historyPage === historyTotalPages">&gt;</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="notif-scheduled" [style.padding-bottom]="scheduledPaddingBottom">
            <div class="ann-scheduled-header">SCHEDULED NOTIFICATIONS</div>
            <div class="scheduled-notif-list">
                <div class="scheduled-notif-card" *ngFor="let notif of upcomingNotifications">
                    <div class="scheduled-notif-card-row">
                        <div class="scheduled-notif-img">
                            <ng-container *ngIf="notif.includeImage && notif.imageBase64; else noImage">
                                <img [src]="'data:image/png;base64,' + notif.imageBase64" alt="Notification Image"
                                    style="width:100%;height:100%;object-fit:cover;border-radius:8px;" />
                            </ng-container>
                            <ng-template #noImage>
                                <div class="scheduled-notif-noimg">No Image</div>
                            </ng-template>
                        </div>
                        <div class="scheduled-notif-info">
                            <div class="scheduled-notif-title">{{ notif.title }}</div>
                            <div class="scheduled-notif-desc">{{ notif.description }}</div>
                            <div class="scheduled-notif-body">{{ notif.messageBody }}</div>
                            <div class="scheduled-notif-date">
                                Scheduled At: {{ notif.scheduledAt | date:'medium' }}
                            </div>
                        </div>
                        <div class="scheduled-notif-actions">
                            <button class="notif-edit-btn" (click)="openEditModal(notif)">
                                <ion-icon name="create-outline" class="edit-icon"></ion-icon>
                            </button>
                            <button class="notif-trash-btn" (click)="confirmDeleteNotification(notif.notificationId)">
                                <ion-icon name="trash-outline" class="trash-icon"></ion-icon>
                            </button>
                        </div>
                    </div>
                </div>
                <div *ngIf="upcomingNotifications.length === 0" class="scheduled-notif-empty">
                    No scheduled notifications.
                </div>
            </div>
        </div>
    </div>
</div>

<div class="edit-modal-backdrop" *ngIf="editModalOpen && editNotification" (click)="closeEditModal()"></div>
<div class="edit-modal" *ngIf="editModalOpen && editNotification">
    <h3>Edit Scheduled Notification</h3>
    <input type="text" [(ngModel)]="editNotification.title" placeholder="Title*" />
    <input type="text" [(ngModel)]="editNotification.description" placeholder="Description" />
    <textarea [(ngModel)]="editNotification.messageBody" placeholder="Message Body"></textarea>
    <div class="edit-modal-when-row">
        <label>When:</label>
        <input matInput [matDatepicker]="editPicker" [(ngModel)]="editNotification.scheduledAt"
            placeholder="Select Date" readonly (click)="editPicker.open()" />
        <button type="button" class="calendar-btn" (click)="editPicker.open()">
            <ion-icon name="calendar-outline"></ion-icon>
        </button>
        <mat-datepicker #editPicker></mat-datepicker>
    </div>
    <label>
        <input type="checkbox" [(ngModel)]="editNotification.includeImage" />
        Include Image
    </label>
    <div class="edit-modal-image-row" *ngIf="editNotification.includeImage">
        <div class="edit-modal-image-upload" (click)="editImageInput.click()">
            <ng-container *ngIf="editImagePreviewUrl; else fallbackImage">
                <img [src]="editImagePreviewUrl" alt="Preview"
                    style="width:100%;height:100%;object-fit:cover;border-radius:8px;" />
            </ng-container>
            <ng-template #fallbackImage>
                <ng-container *ngIf="editNotification.imageBase64; else noImageIcon">
                    <img [src]="'data:image/png;base64,' + editNotification.imageBase64" alt="Existing Image"
                        style="width:100%;height:100%;object-fit:cover;border-radius:8px;" />
                </ng-container>
                <ng-template #noImageIcon>
                    <div class="image-icon">
                        <fa-icon [icon]="faImage"></fa-icon>
                    </div>
                </ng-template>
            </ng-template>
            <input #editImageInput type="file" accept="image/*" style="display:none"
                (change)="onEditImageSelected($event)" />
        </div>
    </div>
    <div class="edit-modal-actions">
        <button (click)="saveEditNotification()">Save</button>
        <button (click)="closeEditModal()">Cancel</button>
    </div>
</div>